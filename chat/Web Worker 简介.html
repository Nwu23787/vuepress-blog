<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Web Worker简介 | Happyblog</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="基于 vuepress 的简易博客平台">
    
    <link rel="preload" href="/vuepress-blog/assets/css/0.styles.631b7830.css" as="style"><link rel="preload" href="/vuepress-blog/assets/js/app.f8677ea4.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/2.32f56e5c.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/1.a930a345.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/42.edf41024.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/js/10.ab76fc9b.js"><link rel="prefetch" href="/vuepress-blog/assets/js/11.8f72b06d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/12.428f6f98.js"><link rel="prefetch" href="/vuepress-blog/assets/js/13.eb47b2b6.js"><link rel="prefetch" href="/vuepress-blog/assets/js/14.7257e695.js"><link rel="prefetch" href="/vuepress-blog/assets/js/15.bd1b03c3.js"><link rel="prefetch" href="/vuepress-blog/assets/js/16.7a561afc.js"><link rel="prefetch" href="/vuepress-blog/assets/js/17.cd516f79.js"><link rel="prefetch" href="/vuepress-blog/assets/js/18.42e9f2b1.js"><link rel="prefetch" href="/vuepress-blog/assets/js/19.4958156f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/20.cd1f9a1c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/21.e4fea2d1.js"><link rel="prefetch" href="/vuepress-blog/assets/js/22.0919633c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/23.331c698f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/24.5874fb5a.js"><link rel="prefetch" href="/vuepress-blog/assets/js/25.e56a5813.js"><link rel="prefetch" href="/vuepress-blog/assets/js/26.7e912fb0.js"><link rel="prefetch" href="/vuepress-blog/assets/js/27.aa11be6f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/28.b8505e46.js"><link rel="prefetch" href="/vuepress-blog/assets/js/29.155d9866.js"><link rel="prefetch" href="/vuepress-blog/assets/js/3.d7d8640a.js"><link rel="prefetch" href="/vuepress-blog/assets/js/30.80297b92.js"><link rel="prefetch" href="/vuepress-blog/assets/js/31.977ccbdd.js"><link rel="prefetch" href="/vuepress-blog/assets/js/32.767609f9.js"><link rel="prefetch" href="/vuepress-blog/assets/js/33.44891ea8.js"><link rel="prefetch" href="/vuepress-blog/assets/js/34.f516ab0b.js"><link rel="prefetch" href="/vuepress-blog/assets/js/35.151a5daf.js"><link rel="prefetch" href="/vuepress-blog/assets/js/36.ece446f9.js"><link rel="prefetch" href="/vuepress-blog/assets/js/37.37735106.js"><link rel="prefetch" href="/vuepress-blog/assets/js/38.45a9e8b8.js"><link rel="prefetch" href="/vuepress-blog/assets/js/39.0fcd7dcc.js"><link rel="prefetch" href="/vuepress-blog/assets/js/4.ecf7f9e8.js"><link rel="prefetch" href="/vuepress-blog/assets/js/40.621682ab.js"><link rel="prefetch" href="/vuepress-blog/assets/js/41.d03d4354.js"><link rel="prefetch" href="/vuepress-blog/assets/js/43.8cd60945.js"><link rel="prefetch" href="/vuepress-blog/assets/js/44.de2cd4e9.js"><link rel="prefetch" href="/vuepress-blog/assets/js/45.4fb41246.js"><link rel="prefetch" href="/vuepress-blog/assets/js/46.b26d762d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/47.3bb572d2.js"><link rel="prefetch" href="/vuepress-blog/assets/js/48.dc6af168.js"><link rel="prefetch" href="/vuepress-blog/assets/js/49.9511edba.js"><link rel="prefetch" href="/vuepress-blog/assets/js/5.8cea2090.js"><link rel="prefetch" href="/vuepress-blog/assets/js/50.2e05304d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/51.f72b0b54.js"><link rel="prefetch" href="/vuepress-blog/assets/js/52.1650a6e6.js"><link rel="prefetch" href="/vuepress-blog/assets/js/53.36c638aa.js"><link rel="prefetch" href="/vuepress-blog/assets/js/54.5931bcf4.js"><link rel="prefetch" href="/vuepress-blog/assets/js/55.f48c6b88.js"><link rel="prefetch" href="/vuepress-blog/assets/js/56.6d799974.js"><link rel="prefetch" href="/vuepress-blog/assets/js/57.0abda071.js"><link rel="prefetch" href="/vuepress-blog/assets/js/58.e4e2e95d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/59.fc9cc726.js"><link rel="prefetch" href="/vuepress-blog/assets/js/6.5b653d91.js"><link rel="prefetch" href="/vuepress-blog/assets/js/60.d0cdc48d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/61.e663cede.js"><link rel="prefetch" href="/vuepress-blog/assets/js/62.1b3ef15b.js"><link rel="prefetch" href="/vuepress-blog/assets/js/63.b17e2bda.js"><link rel="prefetch" href="/vuepress-blog/assets/js/64.3b7bc255.js"><link rel="prefetch" href="/vuepress-blog/assets/js/65.bb24c420.js"><link rel="prefetch" href="/vuepress-blog/assets/js/7.fcec5877.js"><link rel="prefetch" href="/vuepress-blog/assets/js/vendors~docsearch.a0f89813.js">
    <link rel="stylesheet" href="/vuepress-blog/assets/css/0.styles.631b7830.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-blog/" class="home-link router-link-active"><!----> <span class="site-name">Happyblog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress-blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/vuepress-blog/miniVue2/" class="nav-link">
  mini-Vue2 文档
</a></div><div class="nav-item"><a href="/vuepress-blog/performance/" class="nav-link">
  性能优化
</a></div><div class="nav-item"><a href="/vuepress-blog/chat/" class="nav-link router-link-active">
  前端杂谈
</a></div><div class="nav-item"><a href="https://github.com/Nwu23787/mini-Vue2" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepress-blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/vuepress-blog/miniVue2/" class="nav-link">
  mini-Vue2 文档
</a></div><div class="nav-item"><a href="/vuepress-blog/performance/" class="nav-link">
  性能优化
</a></div><div class="nav-item"><a href="/vuepress-blog/chat/" class="nav-link router-link-active">
  前端杂谈
</a></div><div class="nav-item"><a href="https://github.com/Nwu23787/mini-Vue2" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端杂谈</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-blog/chat/浏览器指纹.html" class="sidebar-link">浏览器指纹</a></li><li><a href="/vuepress-blog/chat/浏览器中 ESModule 的工作原理.html" class="sidebar-link">浏览器中 ESModule 的工作原理</a></li><li><a href="/vuepress-blog/chat/浏览器中的事件循环.html" class="sidebar-link">浏览器中的事件循环</a></li><li><a href="/vuepress-blog/chat/资源提示符.html" class="sidebar-link">资源提示符</a></li><li><a href="/vuepress-blog/chat/node模块查找策略.html" class="sidebar-link">node模块查找策略</a></li><li><a href="/vuepress-blog/chat/requestAnimationFrame.html" class="sidebar-link">requestAnimationFrame</a></li><li><a href="/vuepress-blog/chat/WebView 入门.html" class="sidebar-link">WebView 入门</a></li><li><a href="/vuepress-blog/chat/CSS 属性值的计算.html" class="sidebar-link">CSS 属性值的计算</a></li><li><a href="/vuepress-blog/chat/浏览器渲染原理.html" class="sidebar-link">浏览器渲染原理</a></li><li><a href="/vuepress-blog/chat/跨标签页通信的方案与实践（上）.html" class="sidebar-link">跨标签页通信的方案与实践（上）</a></li><li><a href="/vuepress-blog/chat/跨标签页通信的方案与实践（下）.html" class="sidebar-link">跨标签页通信的方案与实践（下）</a></li><li><a href="/vuepress-blog/chat/Web Worker 简介.html" class="active sidebar-link">Web Worker 简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-blog/chat/Web Worker 简介.html#单线程的-javascript" class="sidebar-link">单线程的 JavaScript</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/chat/Web Worker 简介.html#什么是-web-worker" class="sidebar-link">什么是 Web Worker</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/chat/Web Worker 简介.html#web-worker-的类型" class="sidebar-link">Web Worker 的类型</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/chat/Web Worker 简介.html#与主线程的通信" class="sidebar-link">与主线程的通信</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/chat/Web Worker 简介.html#安全与限制" class="sidebar-link">安全与限制</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/chat/Web Worker 简介.html#应用场景" class="sidebar-link">应用场景</a></li></ul></li><li><a href="/vuepress-blog/chat/渲染中的分层与合成.html" class="sidebar-link">渲染中的分层与合成</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="web-worker简介"><a href="#web-worker简介" class="header-anchor">#</a> Web Worker简介</h1> <h2 id="单线程的-javascript"><a href="#单线程的-javascript" class="header-anchor">#</a> 单线程的 JavaScript</h2> <p>JavaScript 是作为浏览器脚本语言而设计的，主要用于与用户交互、操作 DOM，所以在诞生之初，就被设计为了<strong>单线程语言</strong>。</p> <p>最初的 JavaScript 主要是用于操作页面上的 DOM，如果设计为了多线程语言，那么同时可能有多处地方在执行 JS 代码修改 DOM。一旦这些代码修改了同一处 DOM，那么就会导致冲突。</p> <p>此外，<strong>浏览器的 JS 引擎是与 UI 渲染线程互斥</strong>的。当 JS 引擎执行任务时，UI 渲染引擎会被挂起。这是因为 UI 渲染引擎执行的过程中，如果执行 JS 代码，那么可能会导致 DOM 元素被修改，从而进一步导致渲染结果和预期不一致。</p> <p>单线程语言虽然较为安全，避免了多线程竞争条件下的各种问题，但也导致了一系列问题：</p> <ol><li><strong>性能瓶颈</strong>：单线程语言意味着 JavaScript 在同一时间只能执行一个任务，这在需要大量计算或者并发任务的场景中，就显得非常低效了</li> <li><strong>阻塞任务</strong>：一旦有一个任务被阻塞，或是处理时间较长，那么所以其他的任务都会被阻塞，得不到有效的处理</li> <li><strong>无法充分利用多核 CPU 的性能</strong>：现代计算机通常有多个 CPU 核心，单线程无法充分利用这些资源，从而导致资源浪费。</li></ol> <p>为了提高 web 应用的响应速度和用户体验，于是我们引入了 Web Worker 的概念</p> <h2 id="什么是-web-worker"><a href="#什么是-web-worker" class="header-anchor">#</a> 什么是 Web Worker</h2> <blockquote><p><strong>Web Worker</strong> 使得在一个独立于 Web 应用程序主执行线程的后台线程中运行脚本操作成为可能。这样做的好处是可以在独立线程中执行费时的处理任务，使主线程（通常是 UI 线程）的运行不会被阻塞/放慢</p> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API" target="_blank" rel="noopener noreferrer">Web Worker API - Web API | MDN (mozilla.org)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>Web Worker 是浏览器的<strong>内置线程</strong>，允许开发者在浏览器后台运行 JavaScript 代码。创建 Web Worker 时，js 引擎向浏览器申请一个子线程， 子线程完全由浏览器控制，它<strong>完全独立于主线程</strong>，用于自己独立的内存和全局变量，所以可以与主线程并行执行，互不干扰。</p> <p>但是，正如我们前面提到的：我们不希望同时有两处代码在修改 DOM。所以，Web Worker 中是无法直接访问到 DOM 的，请勿将操作 DOM 相关的代码交由 Web Worker 执行。Web Worker 更适合去执行一些耗时的复杂任务，如大量计算等。</p> <h2 id="web-worker-的类型"><a href="#web-worker-的类型" class="header-anchor">#</a> Web Worker 的类型</h2> <p><strong>Dedicated Worker</strong>：专用 Worker。该 Worker <strong>只能</strong>被创建它的脚本使用</p> <p><strong>Shared Worker</strong>：共享 Worker。可以同时被多个标签页使用，但是这些标签页必须<strong>同源</strong>。</p> <p><strong>Service Worker</strong>：服务 Worker。几乎都是用于充当浏览器与服务器之间的<strong>代理服务器</strong>，实现请求的拦截。在<strong>离线场景</strong>中得到了广泛的运用。</p> <h2 id="与主线程的通信"><a href="#与主线程的通信" class="header-anchor">#</a> 与主线程的通信</h2> <p>主线程和Worker线程之间通过<code>postMessage</code>和<code>onmessage</code>事件进行通信。主线程可以向Worker发送消息，Worker处理后再将结果返回给主线程。</p> <p>Shared Worker 与其他 Worker 的通信方式略有差别，需要通过活动端口 <code>port</code> 进行通信。以下是具体步骤：</p> <ol><li><strong>创建Shared Worker</strong>：在主线程中创建Shared Worker实例。</li> <li><strong>获取MessagePort</strong>：通过<code>SharedWorker.port</code>属性获取<code>MessagePort</code>对象。</li> <li><strong>启动端口</strong>：使用<code>port.start()</code>方法启动端口（如果使用<code>addEventListener</code>监听消息）。</li> <li><strong>发送消息</strong>：使用<code>port.postMessage()</code>方法发送消息。</li> <li><strong>接收消息</strong>：通过<code>port.onmessage</code>事件处理接收到的消息。</li></ol> <h2 id="安全与限制"><a href="#安全与限制" class="header-anchor">#</a> 安全与限制</h2> <ol><li><strong>同源</strong>：Web Worker 必须和调用它的页面同源，以确保安全，防止跨站脚本攻击</li> <li><strong>不可访问 DOM</strong>：Worker线程无法直接访问DOM。不能在Worker中直接操作页面元素，但可以通过消息传递与主线程协作。</li> <li><strong>浏览器API受限</strong>：Worker线程中不能使用某些浏览器API，如<code>alert</code>、<code>confirm</code>和<code>localStorage</code>。</li></ol> <h2 id="应用场景"><a href="#应用场景" class="header-anchor">#</a> 应用场景</h2> <ol><li><strong>跨标签页通信</strong>：使用 Shared Worker 或 Service Worker 可以实现跨标签页的消息传递，详情可参考：<a href="https://nwu23787.github.io/vuepress-blog/chat/%E8%B7%A8%E6%A0%87%E7%AD%BE%E9%A1%B5%E9%80%9A%E4%BF%A1%E7%9A%84%E6%96%B9%E6%A1%88%E4%B8%8E%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%8A%EF%BC%89.html#service-worker-onmessage" target="_blank" rel="noopener noreferrer">跨标签页通信的方案与实践（上） | Happyblog<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>大量数据计算</strong>：对于大量数据的计算，在主线程中进行会导致页面卡顿，后续任务被阻塞。此时可以考虑使用 Web Worker 进行计算，主线程继续执行后续任务。待 Web Worker 执行完毕之后，再使用 <code>postMessage</code> 通知主线程。</li> <li><strong>网络请求</strong> ：对于某些耗时较长的网络请求，可以在 Web Worker 中进行，避免阻塞主线程。</li> <li><strong>接口缓存</strong>：对于数据量较大，且数据变化不频繁的接口，可以使用 Service Worker 进行接口缓存。拦截网络请求，不发送给服务器。</li> <li><strong>离线缓存</strong>：对于类似聊天类软件，在离线时依然要展示聊天记录之类的大量数据，可以考虑使用 Service Worker 配合 IndexDB 进行。</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vuepress-blog/chat/跨标签页通信的方案与实践（下）.html" class="prev">
        跨标签页通信的方案与实践（下）
      </a></span> <span class="next"><a href="/vuepress-blog/chat/渲染中的分层与合成.html">
        渲染中的分层与合成
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vuepress-blog/assets/js/app.f8677ea4.js" defer></script><script src="/vuepress-blog/assets/js/2.32f56e5c.js" defer></script><script src="/vuepress-blog/assets/js/1.a930a345.js" defer></script><script src="/vuepress-blog/assets/js/42.edf41024.js" defer></script>
  </body>
</html>
